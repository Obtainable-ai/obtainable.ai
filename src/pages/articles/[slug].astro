---
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';
import BaseLayout from '@/layouts/BaseLayout.astro';
import Footer from '@/components/Footer.astro';

export const getStaticPaths = (async () => {
  const articles = await getCollection('articles', ({ data }) => {
    return data.draft !== true;
  });

  return articles.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }));
}) satisfies GetStaticPaths;

const { article } = Astro.props;
const { Content } = await article.render();

function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
}
---

<BaseLayout
  title={`${article.data.title} - Obtainable`}
  description={article.data.description}
>
  
  <main id="main-content" class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16 text-white">
    <a href="/articles" class="inline-flex items-center text-sm text-gray-200 hover:text-white mb-6 transition-colors">
      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Back to articles
    </a>

    <article class="bg-black/40 backdrop-blur-md border border-white/10 rounded-2xl p-8 md:p-10 shadow-xl">
      <header class="mb-8">
        <time datetime={article.data.publishDate.toISOString()} class="block text-sm text-gray-300 mb-2">
          {formatDate(article.data.publishDate)}
        </time>
        
        <h1 class="text-4xl md:text-5xl font-bold mb-4 leading-tight">
          {article.data.title}
        </h1>
        
        <p class="text-xl text-gray-200">
          {article.data.description}
        </p>

        {article.data.tags && article.data.tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mt-6">
            {article.data.tags.map((tag) => (
              <span class="inline-flex items-center px-3 py-1 text-sm text-white bg-white/10 backdrop-blur-sm border border-white/20 rounded-full">
                {tag}
              </span>
            ))}
          </div>
        )}
      </header>

      <div class="prose prose-lg max-w-none">
        <Content />
      </div>
    </article>
  </main>

  <Footer />
</BaseLayout>

<style is:global>
  .prose {
    color: #e5e7eb;
  }
  .prose h2 {
    font-size: 1.875rem;
    font-weight: 700;
    color: #fff;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    line-height: 1.3;
  }
  .prose h3 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #f9fafb;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
  }
  .prose p {
    margin-bottom: 1.5rem;
    line-height: 1.75;
  }
  .prose a {
    color: #bfdbfe;
    text-decoration: underline;
    text-decoration-color: rgba(191, 219, 254, 0.4);
    text-underline-offset: 2px;
    transition: text-decoration-color 0.2s, color 0.2s;
  }
  .prose a:hover {
    text-decoration-color: rgba(191, 219, 254, 0.9);
    color: #e0f2fe;
  }
  .prose ul, .prose ol {
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
  }
  .prose li {
    margin-bottom: 0.5rem;
  }
  .prose code {
    background-color: rgba(255, 255, 255, 0.08);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
    color: #e0f2fe;
  }
  .prose pre {
    background-color: rgba(0, 0, 0, 0.55);
    color: #f9fafb;
    padding: 1.25rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin-bottom: 1.5rem;
  }
  .prose pre code {
    background-color: transparent;
    padding: 0;
    color: inherit;
  }
  .prose blockquote {
    border-left: 4px solid rgba(255, 255, 255, 0.2);
    padding-left: 1rem;
    font-style: italic;
    color: #d1d5db;
    margin: 1.5rem 0;
  }
</style>
